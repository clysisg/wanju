<div class="row">
    <div class="col-md-12 col-sm-12 col-xs-12">
        <div class="x_panel">
            <div class="x_title">
                <h2>全部用户列表</h2>
                <div class="clearfix"></div>
            </div>
            <div class="x_content" style="display: block;">
                <form action="" id="J_filter_form" method="get">
                    <div class="row">
                        <div class="col-md-3 col-sm-12 com-xs-12">
                            <label class="control-label">用户ID</label>
                            <input type="text" class="form-control" name="form[user_ids]" value="{if isset($smarty.get.form.user_ids)}{$smarty.get.form.user_ids}{/if}" placeholder="英文逗号隔开查询多个"/>
                        </div>
                        <div class="col-md-3 col-sm-12 com-xs-12">
                            <label class="control-label">用户名</label>
                            <input type="text" class="form-control" name="form[user_name]" value="{if isset($smarty.get.form.user_name)}{$smarty.get.form.user_name}{/if}">
                        </div>
                        <div class="col-md-3 col-sm-12 com-xs-12">
                            <label class="control-label">电话号码</label>
                            <input type="text" class="form-control" name="form[reg_mobile]" value="{if isset($smarty.get.form.reg_mobile)}{$smarty.get.form.reg_mobile}{/if}">
                        </div>
                        <div class="col-md-3 col-sm-12 com-xs-12">
                            <label class="control-label">邮箱</label>
                            <input type="text" class="form-control" name="form[reg_email]" value="{if isset($smarty.get.form.reg_email)}{$smarty.get.form.reg_email}{/if}">
                        </div>
                        <div class="col-md-3 col-sm-12 com-xs-12">
                            <label class="control-label">
                                注册渠道
                            </label>
                            <div class="form-group">
                                <select class="form-control" name="form[reg_channel]">
                                    <option value="-1" {if isset($smarty.get.form.reg_channel) && $smarty.get.form.reg_channel == -1}selected{/if}>全部</option>
                                    <option value="1" {if isset($smarty.get.form.reg_channel) && $smarty.get.form.reg_channel == 1}selected{/if}>唯衣网PC</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-12 com-xs-12">
                            <label class="control-label">
                                用户身份
                            </label>
                            <div class="form-group">
                                <select class="form-control" name="form[user_identity]">
                                    <option value=""
                                    {if isset($smarty.get.form.user_identity) && $smarty.get.form.user_identity == ""}selected{/if}>全部
                                    </option>
                                    <option value="SELLER"
                                    {if isset($smarty.get.form.user_identity) && $smarty.get.form.user_identity == "SELLER"}selected{/if}>供应商
                                    </option>
                                    <option value="GUEST"
                                    {if isset($smarty.get.form.user_identity) && $smarty.get.form.user_identity == "GUEST"}selected{/if}>采购商
                                    </option>
                                    <option value="SUB"
                                    {if isset($smarty.get.form.user_identity) && $smarty.get.form.user_identity == "SUB"}selected{/if}>子账号
                                    </option>
                                </select>
                            </div>
                        </div>

                    <div class="row">
                        <div class="col-md-6 col-sm-12 com-xs-12">
                            <label class="control-label">
                                注册时间
                            </label>
                            <div class="form-group">
                                <div class="row">
                                    <div class="col-md-6 com-sm-12 com-xs-12">
                                        <div class="input-prepend input-group">
                                            <span class="add-on input-group-addon"><i class="glyphicon glyphicon-calendar fa fa-calendar"></i></span>
                                            <input type="text"  name="form[start_reg_date]" value="{if isset($smarty.get.form.start_reg_date)}{$smarty.get.form.start_reg_date}{/if}" placeholder="开始时间" id="J_dh_start" class="form-control" >
                                        </div>
                                    </div>
                                    <div class="col-md-6 com-sm-12 com-xs-12">
                                        <div class="input-prepend input-group">
                                            <span class="add-on input-group-addon"><i class="glyphicon glyphicon-calendar fa fa-calendar"></i></span>
                                            <input type="text"  name="form[end_reg_date]" value="{if isset($smarty.get.form.end_reg_date)}{$smarty.get.form.end_reg_date}{/if}" placeholder="结束时间" id="J_dh_end" class="form-control" >
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 col-sm-12 com-xs-12">
                            <label class="control-label">
                                最后一次登录时间
                            </label>
                            <div class="form-group">
                                <div class="row">
                                    <div class="col-md-6 com-sm-12 com-xs-12">
                                        <div class="input-prepend input-group">
                                            <span class="add-on input-group-addon"><i class="glyphicon glyphicon-calendar fa fa-calendar"></i></span>
                                            <input type="text"  name="form[start_last_login_date]" value="{if isset($smarty.get.form.start_last_login_date)}{$smarty.get.form.start_last_login_date}{/if}"  placeholder="开始时间" id="J_start" class="form-control" >
                                        </div>
                                    </div>
                                    <div class="col-md-6 com-sm-12 com-xs-12">
                                        <div class="input-prepend input-group">
                                            <span class="add-on input-group-addon"><i class="glyphicon glyphicon-calendar fa fa-calendar"></i></span>
                                            <input type="text"  name="form[end_last_login_date]" value="{if isset($smarty.get.form.end_last_login_date)}{$smarty.get.form.end_last_login_date}{/if}"  placeholder="结束时间" id="J_end" class="form-control" >
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    </div>
                    <div class="row" style="margin-left: 45%">
                            <button type="button" class="btn btn-warning" id="reset_button">重置</button>
                            <button type="submit" class="btn btn-primary">查询</button>
                            <a href="{$data.exportUrl}" class="btn btn-success">导出结果数据</a>
                    </div>
                    <input id="sort_field" type="hidden" name="form[orderby]" value=""/>
                </form>
            </div>


        <div>
          用户总数量：{$data.filterResult.totalCount}
        </div>
        <div>
          查询结果数量：{$data.filterResult.searchCount}
        </div>
        <div class="cont">
          <table class="table table-bordered table-striped">
              <thead>
                  <tr>
                      <th width="">#</th>
                      <th width="">用户ID<br/><i sort_field='u.user_id' class="fa fa-arrow-up"></i><i sort_field='u.user_id' class="fa fa-arrow-down"></th>
                      <th width="">用户名<br/><br/></th>
                      <th width="">用户身份<br/><br/></th>
                      <th width="">电话号码<br/><br/></th>
                      <th width="">邮箱<br/><br/></th>
                      <th width="">微信绑定<br/><br/></th>
                      <th width="">QQ绑定<br/><br/></th>
                      <th width="">注册时间<br/><i sort_field='u.createtime' class="fa fa-arrow-up"></i><i sort_field='u.createtime' class="fa fa-arrow-down"></th>
                      <th width="">注册渠道<br/><br/></th>
                      <th width="">最后一次登录时间<br/><i sort_field='u.last_login_date' class="fa fa-arrow-up"></i><i sort_field='u.last_login_date' class="fa fa-arrow-down"></th>
                      <th width="">操作<br/><br/></th>
                  </tr>
              </thead>
              <tbody>
              {foreach $data.filterResult.userList AS $key => $user}
                  <tr>
                      <td>
                          {$user.display_order}
                      </td>
                      <td>
                          {$user.user_id}
                      </td>
                      <td>
                          {$user.user_name}
                      </td>
                      <td>
                          {$user.user_identity_name}
                      </td>
                      <td>
                          {$user.reg_mobile}
                      </td>
                      <td>
                          {$user.reg_email}
                      </td>
                      <td>
                          {$user.is_bind_wechat}
                      </td>
                      <td>
                          {$user.is_bind_qq}
                      </td>
                      <td>
                          {$user.reg_date}
                      </td>
                      <td>
                          {$user.reg_channel}
                      </td>
                      <td>
                          {$user.last_login_date}
                      </td>
                      <td>
                          <a class="btn btn-primary btn-xs" target="_blank" href="{$user.user_detail_url}"> 查看用户详情</a>
                      </td>
                  </tr>
                  {/foreach}
              </tbody>
          </table>
            <!--分页-->
            </div>
            {Yii::$app->view->render('/com/pager.php',['pager'=>$data.filterResult.pager])}
        </div>
    </div>
</div>


<script src="{$data.theme}/js/source/layer/layer.js"></script>
<script src="{$data.theme}/js/source/clipboard.js"></script>
<script type="text/javascript" src="{$data.theme}/libs/js/datepicker/bootstrap-datetimepicker.min.js"></script>
{literal}
<script>
    var clipboard = new Clipboard('.J_clipboard');
    clipboard.on('success', function(e) {
        layer.msg('复制成功！');
    });
    clipboard.on('error', function(e) {
        layer.msg('复制失败')
    });
    var startDate = $('#J_start').datetimepicker({
        format: "yyyy-MM-dd hh:ii:ss",
        autoclose: true,
        todayBtn: true
    }).on('changeDate', function(ev) {
        var end = $('#J_end').val();
        var evDate = ev.date.getFullYear() + '-' + (ev.date.getMonth() + 1) + '-' + ev.date.getDate();
        if($.trim(end) != '') {
            var dt = new Date(end);
            if(ev.date.valueOf() > dt.valueOf()) {
                $('#J_end').val('');
            }
        }
        $('#J_end').datetimepicker('setStartDate', evDate);

    });

    var endDate = $('#J_end').datetimepicker({
        format: "yyyy-MM-dd hh:ii:ss",
        autoclose: true,
        todayBtn: true
    }).on('changeDate', function(ev) {
        var end = $('#J_start').val();
        var evDate = ev.date.getFullYear() + '-' + (ev.date.getMonth() + 1) + '-' + ev.date.getDate();
        if($.trim(end) != '') {
            var dt = new Date(end);
            if(ev.date.valueOf() < dt.valueOf()) {
                $('#J_start').val('');
            }
        }
        $('#J_start').datetimepicker('setEndDate', evDate);
    });

    var startDate = $('#J_dh_start').datetimepicker({
        format: "yyyy-MM-dd hh:ii:ss",
        autoclose: true,
        todayBtn: true
    }).on('changeDate', function(ev) {
        var end = $('#J_dh_end').val();
        var evDate = ev.date.getFullYear() + '-' + (ev.date.getMonth() + 1) + '-' + ev.date.getDate();
        if($.trim(end) != '') {
            var dt = new Date(end);
            if(ev.date.valueOf() > dt.valueOf()) {
                $('#J_end').val('');
            }
        }
        $('#J_dh_end').datetimepicker('setStartDate', evDate);

    });

    var endDate = $('#J_dh_end').datetimepicker({
        format: "yyyy-MM-dd hh:ii:ss",
        autoclose: true,
        todayBtn: true
    }).on('changeDate', function(ev) {
        var end = $('#J_dh_start').val();
        var evDate = ev.date.getFullYear() + '-' + (ev.date.getMonth() + 1) + '-' + ev.date.getDate();
        if($.trim(end) != '') {
            var dt = new Date(end);
            if(ev.date.valueOf() < dt.valueOf()) {
                $('#J_dh_start').val('');
            }
        }
        $('#J_dh_start').datetimepicker('setEndDate', evDate);
    });

    var xjstartDate = $('#J_xj_start').datetimepicker({
        format: "yyyy-MM-dd hh:ii:ss",
        autoclose: true,
        todayBtn: true
    }).on('changeDate', function(ev) {
        var end = $('#J_xj_end').val();
        var evDate = ev.date.getFullYear() + '-' + (ev.date.getMonth() + 1) + '-' + ev.date.getDate();
        if($.trim(end) != '') {
            var dt = new Date(end);
            if(ev.date.valueOf() > dt.valueOf()) {
                $('#J_xj_end').val('');
            }
        }
        $('#J_xj_end').datetimepicker('setStartDate', evDate);

    });

    var xjendDate = $('#J_xj_end').datetimepicker({
        format: "yyyy-MM-dd hh:ii:ss",
        autoclose: true,
        todayBtn: true
    }).on('changeDate', function(ev) {
        var end = $('#J_xj_start').val();
        var evDate = ev.date.getFullYear() + '-' + (ev.date.getMonth() + 1) + '-' + ev.date.getDate();
        if($.trim(end) != '') {
            var dt = new Date(end);
            if(ev.date.valueOf() < dt.valueOf()) {
                $('#J_xj_start').val('');
            }
        }
        $('#J_xj_start').datetimepicker('setEndDate', evDate);
    });
    //调整显示框长度
    // $(".right_col").css("height", 2000);
    //重置所有选择
    $('#reset_button').click(function(){
        $('input[type=text]').val('');
        $('select').prop('selectedIndex', 0);
        $('form').submit();
    });

    //列表排序
    $('.fa-arrow-up').click(function() {
        var sort_field = $(this).attr('sort_field');
        if (sort_field == 'i.modify_date' || sort_field == 'i.upcloud_date' || sort_field == 'i.downcloud_date' || sort_field == 'i.delete_date' || sort_field == 'i.cloud_sale_num') {
            return;
        }
        $(this).css('color','blue');
        $('#sort_field').val(sort_field + ' asc');
        $('form').submit();
    });
    $('.fa-arrow-down').click(function() {
        var sort_field = $(this).attr('sort_field');
        if (sort_field == 'i.modify_date' || sort_field == 'i.upcloud_date' || sort_field == 'i.downcloud_date' || sort_field == 'i.delete_date' || sort_field == 'i.cloud_sale_num') {
            return;
        }
        $(this).css('color','blue');
        $('#sort_field').val(sort_field + ' desc');
        $('form').submit();
    });
</script>
{/literal}
